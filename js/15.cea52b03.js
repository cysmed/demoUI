(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{b85c:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[e.loadingSomethingBigger?i("q-linear-progress",{attrs:{indeterminate:"",color:"negative"}}):e._e(),i("breadcrumbs",{attrs:{links:e.links}}),i("q-tabs",{staticClass:"text-black bg-secondary",attrs:{align:"left"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab",{attrs:{name:"users",icon:"people",label:"Members"}}),i("q-tab",{attrs:{name:"owner",icon:"supervisor_account",label:"Owner"}})],1),i("q-tab-panels",{staticClass:"q-ma-none full-width q-pa-none",attrs:{animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab-panel",{staticClass:"q-pa-none q-ma-none",attrs:{name:"users"}},[i("facilityMembers",{attrs:{main:e.localmain,immediateMain:e.immediateMain}})],1),i("q-tab-panel",{staticClass:"q-pa-none q-ma-none",attrs:{name:"owner"}},[i("facilityOwner",{attrs:{main:e.localmain,immediateMain:e.immediateMain}})],1)],1)],1)},s=[],l=(i("5319"),i("ddb0"),i("2cbd")),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"padding bg-grey-1"},[e.rightSideBar?i("rightSideBar",{attrs:{main:e.localmain,objType:"facilityMember"}}):e._e(),i("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.saveFacilityMemberDialog,callback:function(t){e.saveFacilityMemberDialog=t},expression:"saveFacilityMemberDialog"}},[i("q-card",{staticClass:"q-ma-md"},[i("q-card-section",{staticClass:"bg-secondary text-white text-center"},[i("div",{staticClass:"text-h6"},[e._v(e._s(e.extendedProjectName))]),i("div",{staticClass:"text-caption"},[e._v("Add User to Facility")])]),i("q-card-section",{staticClass:"bg-secondary text-white"},[i("saveFacilityMember",{attrs:{inside:"true",main:e.localmain,parentMain:e.main}})],1)],1)],1),i("div",{staticClass:"row q-gutter-lg q-ma-none q-pa-none"},[i("cardTotal",{staticClass:"col-12 col-lg-2 col-md-3 col-sm-12 bg-transparent q-ma-none",attrs:{title:"All Members","background-color":"members"===e.activeElement_?"bg-secondary":"bg-primary","icon-name":"person",total:e.numUsers,link:e.allMembersLink}}),i("cardTotal",{staticClass:"col-12 col-lg-2 col-md-3 col-sm-12 bg-transparent q-ma-none",attrs:{title:"Facility_Admin","background-color":"facility_admin"===e.activeElement_?"bg-secondary":"bg-primary","icon-name":"settings",total:e.numSysAdmins,link:e.orgAdminsLink}})],1),i("q-table",{staticClass:"col",attrs:{title:"Facility Members",dense:"",data:e.allOrgMembers,columns:e.columns,filter:e.filter,"row-key":"index"},on:{"row-click":e.selectUser},scopedSlots:e._u([{key:"top-right",fn:function(){return[i("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1),i("q-btn",{attrs:{flat:""}},[i("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(t){return e.listFacilityMembers()}}})],1),i("q-btn",{attrs:{flat:""}},[i("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:function(t){e.saveFacilityMemberDialog=!0}}})],1)]},proxy:!0}])})],1)},r=[],c=(i("cf57"),i("310f")),o=i("46c6"),m=function(){var e=this,t=this,i=t.$createElement,a=t._self._c||i;return a("q-form",{ref:"saveFacilityMemberForm",staticClass:"q-gutter-md text-white",on:{submit:t.saveFacilityMember,reset:t.onReset}},[a("q-input",{attrs:{filled:"",type:"text",label:"Facility name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter a name for your facility"}],disable:!0},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.main.currentFacility.facilityName,callback:function(e){t.$set(t.main.currentFacility,"facilityName",e)},expression:"main.currentFacility.facilityName"}}),a("q-input",{attrs:{filled:"",type:"email",label:"email","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("q-select",{attrs:{filled:"",options:t.authorities,label:"Authority","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please select authority"}]},model:{value:t.authority,callback:function(e){t.authority=e},expression:"authority"}}),a("div",[a("q-btn",{attrs:{label:"Submit",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"white",flat:""}})],1)],1)},d=[];const u=i("1712").to,h=i("20e6"),y=i("c2a1").default;var b={name:"saveFacilityMember",components:{},props:["main","parentMain"],beforeDestroy(){this.main.loadingSomethingBigger=!1},async created(){y.setSettings({TBURL:h["TB_URL"]}),y.setSettings(h)},data(){return{facilityName:"",email:"",authority:"",authorities:["FACILITY_ADMIN","FACILITY_USER"]}},methods:{submit(){this.$refs.saveFacilityMemberForm.submit()},isValidEmail(){return y.isValidEmail(this.email)},async saveFacilityMember(){return y.setSettings({TBURL:h["TB_URL"]}),new Promise((async(e,t)=>{let i=this.facilityName,{email:a,authority:s}=this,l=this.main.currentFacility.facilityId;this.parentMain.loadingSomethingBigger=!0;let[n,r]=await u(y.saveFacilityMember({email:a,authority:s,facilityId:l}));if(this.parentMain.loadingSomethingBigger=!1,n){n=n.msg||n.message||n.error||n;try{n=JSON.parse(n)}catch(c){}if("object"===typeof n){let e=Object.keys(n);n=n[e[0]]}return this.$q.notify({type:"negative",message:n}),e(!1)}this.$q.notify({type:"positive",message:`${i} created.`}),this.main.saveFacilityMemberDialog=!1,this.main.listFacilityMembers()}))},onReset(){this.facilityName=null}}},g=b,f=i("2877"),p=i("0378"),w=i("27f9"),F=i("ddd8"),v=i("9c40"),M=i("eebe"),k=i.n(M),q=Object(f["a"])(g,m,d,!1,null,null,null),O=q.exports;k()(q,"components",{QForm:p["a"],QInput:w["a"],QSelect:F["a"],QBtn:v["a"]});var I=i("4d6d");const _=i("20e6"),C=i("c2a1").default,S=i("1712").to;var x={name:"facilityMembers",props:["main","immediateMain"],components:{loginForm:c["a"],cardTotal:o["a"],saveFacilityMember:O,rightSideBar:I["default"]},watch:{$route(e,t){this.setfilters(e.path)}},data(){return{extendedProjectName:"",facilityId:null,currentFacility:{},orgAdminsLink:"",allMembersLink:"",activeElement_:"",localmain:this,editted:!1,rightSideBar:!1,saveFacilityMemberDialog:!1,loaded:!0,links:[{label:"Settings",icon:"settings",to:"/system"},{label:"Users",icon:"people",to:"/system/users"}],checkedLoggedIn:!1,loggedIn:!1,listHck:[{name:"Users",icon:"settings",link:"/#/system/users",Authority:"Manage Users and Facilities",description:"Manage Users and Facilities"}],filter:"",columnsHck:[],columns:[{name:"email",label:"Email",field:"email",sortable:!0},{name:"authority",label:"Authority",field:"authority",sortable:!0},{name:"createdAt",label:"Created",field:"createdAt",sortable:!0}],numUsers:0,numSysAdmins:0,numActiveUsers:0,numInactiveUsers:0,numEnabledUsers:0,numDisabledusers:0,allOrgMembers:[],selectedRow:{}}},async created(){C.setVue(this),C.setSettings({TBURL:_["TB_URL"]}),this.extendedProjectName=_["PROJECTEXTENDED"];let e,t,i,a=window.location.hash.replace(/^[#]*[\/]*/,""),s=a.split("/");s&&("facilities"===s[1]&&(e=s[3],t=s[4],i=s[5]||""),this.facilityId=e,this.section=t,this.subsection=i);let l="";l="user"===this.gettingFacilityFor?`/#/system/facilities/${this.main.selectedRow.userId}/${this.facilityId}/users`:`/#/system/facilities/${s[2]}/${s[3]}/users`,this.allMembersLink=l,this.orgAdminsLink=`${l}/facility_admin`,this.setfilters(),await this.facilityOwner(),await this.getCurrentFacility(),await this.listFacilityMembers()},methods:{async getCurrentFacility(){return new Promise((async(e,t)=>{let[i,a]=await S(C.getFacilityById(this.facilityId));if(i)return e(!1);this.currentFacility=a,e(!0)}))},async facilityOwner(){return new Promise((async(e,t)=>{let[i,a]=await S(C.getFacilityById(this.facilityId));if(i)return e(!1);this.currentFacilityOwner=a,console.log("OWNER",this.currentFacilityOwner),e(!0)}))},async listFacilityMembers(){await this.facilityOwner(),this.filters||(this.filters={}),this.filters.facilityId=this.facilityId,this.main.loadingSomethingBigger=!0;let[e,t]=await S(C.listFacilityMembers(this.filters));this.main.loadingSomethingBigger=!1,this.allOrgMembers=t||[],this.allOrgMembers=this.allOrgMembers.map((e=>{try{e.isOwner=e.userId===this.currentFacilityOwner.userId}catch(t){}return e})),this.numUsers=this.allOrgMembers.length,this.numSysAdmins=this.allOrgMembers.filter((e=>"FACILITY_ADMIN"===e.authority)).length,this.numActiveUsers=this.allOrgMembers.filter((e=>!0===e.isActive)).length,this.numInactiveUsers=this.allOrgMembers.filter((e=>!1===e.isActive)).length,this.numEnabledUsers=this.allOrgMembers.filter((e=>!0===e.enabled)).length,this.numDisabledusers=this.allOrgMembers.filter((e=>!1===e.enabled)).length},setfilters(e=!1){let t,i,a,s=(e||window.location.hash).replace(/^[#]*[\/]*/,""),l=s.split("/");switch(l&&("facilities"===l[1]&&(t=l[3],i=l[4],a=l[5]||""),this.facilityId=t,this.section=i,this.subsection=a),l[5]){case"facility_admin":this.filters={},this.activeElement_="facility_admin",this.filters={authority:"facility_admin"};break;default:this.filters={},this.activeElement_="members"}this.listFacilityMembers()},selectApplication(e){window.location.assign(e)},gotoPage(e){window.location.assign(e)},selectUser(e,t){console.log({row:t}),this.selectedUser=!0,this.selectedEmail=t.email,this.selectedId="object"===typeof t.id?t.id.id:t.id,this.selecteduserId=t.userId,this.selectedFirstName=t.firstName,this.selectedLastName=t.lastName,this.selectedFullName=`${this.selectedFirstName} ${this.selectedLastName}`,this.selectedIsOwner=t.isOwner,this.selectedRow=t,this.rightSideBar=!1,this.$nextTick((()=>this.rightSideBar=!0))}},computed:{activeElement(){return this.activeElement_},cardContainerClass(){if(this.$q.screen.gt.xs)return"grid-masonry grid-masonry--"+(this.$q.screen.gt.sm?"6":"4")}}},E=x,B=i("9989"),A=i("6b1d"),U=i("24e8"),T=i("f09f"),N=i("a370"),$=i("eaac"),L=i("0016"),Q=Object(f["a"])(E,n,r,!1,null,null,null),P=Q.exports;k()(Q,"components",{QPage:B["a"],QLinearProgress:A["a"],QDialog:U["a"],QCard:T["a"],QCardSection:N["a"],QTable:$["a"],QInput:w["a"],QIcon:L["a"],QBtn:v["a"]});var R=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"padding"},[i("div",{staticClass:"row q-gutter-lg q-ma-none q-pa-none"},[i("cardTotal",{staticClass:"col-12 col-lg-2 col-md-3 col-sm-12 bg-transparent q-ma-none",attrs:{title:e.currentFacilityOwner.firstName+" "+e.currentFacilityOwner.lastName,"background-color":"bg-secondary","icon-name":"person",total:e.currentFacilityOwner.email,link:e.currentFacilityOwner.email,smallsize:!0}})],1)])},D=[];const j=i("20e6"),z=i("c2a1").default,V=i("1712").to;var J={name:"facilityOwner",props:["main","immediateMain"],components:{cardTotal:o["a"]},watch:{$route(e,t){this.setfilters(e.path)}},data(){return{currentFacilityOwner:{}}},async created(){z.setVue(this),z.setSettings({TBURL:j["TB_URL"]});let e,t,i,a=window.location.hash.replace(/^[#]*[\/]*/,""),s=a.split("/");s&&("facilities"===s[1]&&(e=s[3],t=s[4],i=s[5]||""),this.facilityId=e,this.section=t,this.subsection=i),await this.facilityOwner()},methods:{async facilityOwner(){return new Promise((async(e,t)=>{let[i,a]=await V(z.getFacilityById(this.facilityId));if(i)return e(!1);this.currentFacilityOwner=a,e(!0)}))}},computed:{activeElement(){return this.activeElement_},cardContainerClass(){if(this.$q.screen.gt.xs)return"grid-masonry grid-masonry--"+(this.$q.screen.gt.sm?"6":"4")}}},Y=J,H=Object(f["a"])(Y,R,D,!1,null,null,null),Z=H.exports,W=i("22aa");i("20e6");const X=i("c2a1").default,G=i("1712").to;var K={name:"manageFacility",props:["main"],components:{facilityMembers:P,facilityOwner:Z,facilities:W["default"],breadcrumbs:l["a"]},async created(){let e,t,i=window.location.hash.replace(/^[#]*[\/]*/,""),a=i.match(/system\/(facilities)\/[0-9a-z-]+\/([0-9a-z-]+)[\/]*([a-zA-Z]+)/);a&&"facilities"===a[1]&&(e=a[2],t=a[3]),this.facilityId=e,t&&(this.tab=t);let[s,l]=await G(X.getFacilityById(this.facilityId));this.links[this.links.length-1].label=l.facilityName},data(){return{tab:"users",immediateMain:this,localmain:this,links:[{label:"Settings",icon:"settings",to:"/system"},{label:"Facilities",icon:"house",to:"/"+window.location.hash.split("/").slice(1,4).join("/")},{label:"Selected",icon:"house",to:"/system/facilities"}],loadingSomethingBigger:!1}},methods:{setfilters(e){let t,i,a=(e||window.location.hash).replace(/^[#]*[\/]*/,""),s=a.match(/(facilities)\/([0-9a-z-]+)[\/]*([a-zA-Z]+)/);s&&"facilities"===s[1]&&(t=s[2],i=s[3]),i&&(this.tab=i)}},computed:{}},ee=K,te=i("429bb"),ie=i("7460"),ae=i("adad"),se=i("823b"),le=Object(f["a"])(ee,a,s,!1,null,null,null);t["default"]=le.exports;k()(le,"components",{QPage:B["a"],QLinearProgress:A["a"],QTabs:te["a"],QTab:ie["a"],QTabPanels:ae["a"],QTabPanel:se["a"]})}}]);